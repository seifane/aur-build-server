apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: aurbuild
data:
  config_server.json: |
    {
      "log_level": "info",
      "log_path": "./aur_build_server.log",
    
      "api_key": "changeme",
      "port": 8888,
    
      "repo_name": "aurbuild",
      "sign_key": null,
      "rebuild_time": 86400,
    
      "serve_path": "./server/serve",
      "build_logs_path": "./server/build_logs",
    
      "webhooks": [
        "http://yourwebhookhost.test/webhook"
      ],
      "packages": [
        {
          "name": "google-chrome",
          "patches": [
            {
              "url": "https://gist.githubusercontent.com/seifane/d1b04045a02452ada1fe894d18e2c2aa/raw/bc01f21fc579164d69dff0191685647d81d4b27e/gistfile1.txt",
              "sha512": "cb8e7696fb1ff4fd6ed0d5200b2665c470aaf1ed2f67e0b73762b242327bdde34512afcf728151656d3442579e655465fc6d6fb89ff4412fad16357eb9c7632a"
            }
          ]
        },
        {
          "name": "tor-browser",
          "run_before": "gpg --auto-key-locate nodefault,wkd --locate-keys torbrowser@torproject.org"
        }
      ]
    }
  config_worker.json: |
    {
      "base_url": "http://archrepo-server-app:8888",
      "base_url_ws": "ws://archrepo-server-app:8888",
      "api_key": "changeme",
    
      "data_path": "./worker/data",
      "sandbox_path": "./worker/sandbox",
      "build_logs_path": "./worker/logs",
    
      "pacman_config_path": "./config/pacman.conf",
      "pacman_mirrorlist_path": "./config/mirrorlist",
    
      "log_path": "./aur-build-worker.log",
      "log_level": "info"
    }
  pacman.conf: |
    #
    # /etc/pacman.conf
    #
    # See the pacman.conf(5) manpage for option and repository directives

    #
    # GENERAL OPTIONS
    #
    [options]
    # The following paths are commented out with their default values listed.
    # If you wish to use different paths, uncomment and update the paths.
    #RootDir     = /
    #DBPath      = /var/lib/pacman/
    #CacheDir    = /var/cache/pacman/pkg/
    #LogFile     = /var/log/pacman.log
    #GPGDir      = /etc/pacman.d/gnupg/
    #HookDir     = /etc/pacman.d/hooks/
    HoldPkg     = pacman glibc
    #XferCommand = /usr/bin/curl -L -C - -f -o %o %u
    #XferCommand = /usr/bin/wget --passive-ftp -c -O %o %u
    #CleanMethod = KeepInstalled
    Architecture = auto

    # Pacman won't upgrade packages listed in IgnorePkg and members of IgnoreGroup
    #IgnorePkg   =
    #IgnoreGroup =

    #NoUpgrade   =
    #NoExtract   =

    # Misc options
    #UseSyslog
    #Color
    #NoProgressBar
    CheckSpace
    #VerbosePkgLists
    #ParallelDownloads = 5

    # By default, pacman accepts packages signed by keys that its local keyring
    # trusts (see pacman-key and its man page), as well as unsigned packages.
    SigLevel    = Required DatabaseOptional
    LocalFileSigLevel = Optional


    [core]
    Include = /etc/pacman.d/mirrorlist

    [extra]
    Include = /etc/pacman.d/mirrorlist

    [community]
    Include = /etc/pacman.d/mirrorlist

    [multilib]
    Include = /etc/pacman.d/mirrorlist

    #[multilib-testing]
    #Include = /etc/pacman.d/mirrorlist

    #[testing]
    #Include = /etc/pacman.d/mirrorlist

    #[community-testing]
    #Include = /etc/pacman.d/mirrorlist

    # An example of a custom package repository.  See the pacman manpage for
    # tips on creating your own repositories.
    #[custom]
    #SigLevel = Optional TrustAll
    #Server = file:///home/custompkgs
  mirrorlist: |
    ################################################################################
    ################# Arch Linux mirrorlist generated by Reflector #################
    ################################################################################

    # With:       reflector --country Singapore --fastest 5 --latest 100
    # When:       2024-07-10 13:51:39 UTC
    # From:       https://archlinux.org/mirrors/status/json/
    # Retrieved:  2024-07-10 13:51:27 UTC
    # Last Check: 2024-07-10 13:41:28 UTC

    Server = http://mirror.sg.gs/archlinux/$repo/os/$arch
    Server = https://mirror.sg.gs/archlinux/$repo/os/$arch
    Server = http://sg.mirrors.cicku.me/archlinux/$repo/os/$arch
    Server = http://ossmirror.mycloud.services/os/linux/archlinux/$repo/os/$arch
    Server = https://sg.mirrors.cicku.me/archlinux/$repo/os/$arch
